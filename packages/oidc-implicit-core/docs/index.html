<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@hawaii-framework/oidc-implicit-core</title>
	<meta name="description" content="Documentation for @hawaii-framework/oidc-implicit-core">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@hawaii-framework/oidc-implicit-core</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>@hawaii-framework/oidc-implicit-core</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#oidc-implicit-core" id="oidc-implicit-core" style="color: inherit; text-decoration: none;">
					<h1>OIDC Implicit Core</h1>
				</a>
				<a href="#how-to-set-the-oidc-config" id="how-to-set-the-oidc-config" style="color: inherit; text-decoration: none;">
					<h2>How to set the OIDC Config</h2>
				</a>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">configService</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #001080">oidcConfig</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">authorisation:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">client_id:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  ...</span><span style="color: #001080">etc</span><span style="color: #000000">,</span>
<span style="color: #000000">};</span>
</code></pre>
				<a href="#how-to-set-the-auth-headers-on-api-requests" id="how-to-set-the-auth-headers-on-api-requests" style="color: inherit; text-decoration: none;">
					<h2>How to set the Auth headers on API requests</h2>
				</a>
				<p>To access resources, a request may need to include authentication information. This is done via te authorization header. In the following example, we use axios&#39; request interceptors to add this authorization header. Take caution that you only include this header in requests for protected resources; simply including the header in every request is a security risk. With axios, you may create various axios instances with different interceptors to deal with this. With other implementations, you may need to include headers at a request level.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #001080">TokenService</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">SessionUtil</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">SessionService</span><span style="color: #000000">,</span>
<span style="color: #000000">} </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26">setAuthHeader</span><span style="color: #000000"> = </span><span style="color: #0000FF">async</span><span style="color: #000000"> (</span>
<span style="color: #000000">  </span><span style="color: #001080">config</span><span style="color: #000000">: </span><span style="color: #267F99">AxiosRequestConfig</span>
<span style="color: #000000">): </span><span style="color: #267F99">Promise</span><span style="color: #000000">&lt;</span><span style="color: #267F99">AxiosRequestConfig</span><span style="color: #000000">&gt; </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">storedToken</span><span style="color: #000000"> = </span><span style="color: #795E26">getStoredToken</span><span style="color: #000000">();</span>

<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">storedToken</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">config</span><span style="color: #000000">.</span><span style="color: #001080">headers</span><span style="color: #000000">[</span><span style="color: #A31515">&quot;Authorization&quot;</span><span style="color: #000000">] = </span><span style="color: #001080">SessionUtil</span><span style="color: #000000">.</span><span style="color: #795E26">getAuthHeader</span><span style="color: #000000">(</span><span style="color: #001080">storedToken</span><span style="color: #000000">);</span>

<span style="color: #000000">    </span><span style="color: #008000">// For info see Token Expiration section in Readme</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">storedToken</span><span style="color: #000000">.</span><span style="color: #001080">expires</span><span style="color: #000000"> - </span><span style="color: #267F99">Math</span><span style="color: #000000">.</span><span style="color: #795E26">round</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Date</span><span style="color: #000000">().</span><span style="color: #795E26">getTime</span><span style="color: #000000">() / </span><span style="color: #098658">1000.0</span><span style="color: #000000">) &lt; </span><span style="color: #098658">300</span><span style="color: #000000">) {</span>
<span style="color: #000000">      </span><span style="color: #001080">SessionUtil</span><span style="color: #000000">.</span><span style="color: #795E26">silentRefreshAccessToken</span><span style="color: #000000">();</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">config</span><span style="color: #000000">;</span>
<span style="color: #000000">  } </span><span style="color: #AF00DB">else</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #008000">// The check session method will either return</span>
<span style="color: #000000">    </span><span style="color: #008000">// that the user is indeed logged in, or redirect</span>
<span style="color: #000000">    </span><span style="color: #008000">// the user to the login page. This redirection</span>
<span style="color: #000000">    </span><span style="color: #008000">// will be triggered automatically by the library.</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">isLoggedIn</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">SessionService</span><span style="color: #000000">.</span><span style="color: #795E26">checkSession</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">isLoggedIn</span><span style="color: #000000">) {</span>
<span style="color: #000000">      </span><span style="color: #001080">config</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">setAuthHeader</span><span style="color: #000000">(</span><span style="color: #001080">config</span><span style="color: #000000">);</span>
<span style="color: #000000">      </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">config</span><span style="color: #000000">;</span>
<span style="color: #000000">    } </span><span style="color: #AF00DB">else</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #AF00DB">throw</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">axios</span><span style="color: #000000">.</span><span style="color: #795E26">Cancel</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;User is not logged in&quot;</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">};</span>

<span style="color: #008000">// Add a request interceptor</span>
<span style="color: #001080">axios</span><span style="color: #000000">.</span><span style="color: #001080">interceptors</span><span style="color: #000000">.</span><span style="color: #001080">request</span><span style="color: #000000">.</span><span style="color: #795E26">use</span><span style="color: #000000">(</span><span style="color: #001080">setAuthHeader</span><span style="color: #000000">, (</span><span style="color: #001080">error</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #267F99">Promise</span><span style="color: #000000">.</span><span style="color: #795E26">reject</span><span style="color: #000000">(</span><span style="color: #001080">error</span><span style="color: #000000">);</span>
<span style="color: #000000">});</span>
</code></pre>
				<a href="#how-do-i-check-if-the-user-is-authenticated" id="how-do-i-check-if-the-user-is-authenticated" style="color: inherit; text-decoration: none;">
					<h2>How do I check if the user is authenticated?</h2>
				</a>
				<p>On a page level, users should be redirected if they are not authenticated. For this, you can use the check session method. Do note that this method returns a Promise.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">SessionService</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #008000">// Somewhere in your router</span>
<span style="color: #001080">SessionService</span><span style="color: #000000">.</span><span style="color: #795E26">checkSession</span><span style="color: #000000">().</span><span style="color: #795E26">then</span><span style="color: #000000">((</span><span style="color: #001080">isAuthenticated</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">isAuthenticated</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #008000">// We may proceed.</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">});</span>
</code></pre>
				<p>On a component level, you need to make sure at least a token is stored</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">TokenService</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #008000">// If a token is stored, we can assume the user is logged in. This call is synchronous and will as such not influence rendering the page.</span>
<span style="color: #795E26">getStoredToken</span><span style="color: #000000">();</span>
</code></pre>
				<a href="#token-expiration" id="token-expiration" style="color: inherit; text-decoration: none;">
					<h2>Token expiration</h2>
				</a>
				<p>Often times, the access token is set to expire after a certain period. Before this period is over, we can still request a new token. The renewal of a token should only take place as long as the user continues to use the application. If the application renews tokens without paying attention to user activity, it is a potential threat to the security of the user&#39;s information.</p>
				<p>A common way to detect application usage is to hook into requests that have been authenticated. These are either requests to the backend API (i.e. requests to protected resources) or front-end navigation to routes that require authentication. In addition, the necessity of creating a new token must be considered. If the expiration time is still far in the future, it should be decided not to renew the token yet.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #001080">SessionUtil</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">SessionService</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">Token</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">TokenService</span><span style="color: #000000">,</span>
<span style="color: #000000">} </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26">refreshTokenAboutToExpire</span><span style="color: #000000"> = (</span><span style="color: #001080">token</span><span style="color: #000000">?: </span><span style="color: #267F99">Token</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span>
<span style="color: #000000">    </span><span style="color: #001080">token</span><span style="color: #000000"> &amp;&amp;</span>
<span style="color: #000000">    </span><span style="color: #008000">// The expiry time is calculated in seconds since 1970</span>
<span style="color: #000000">    </span><span style="color: #008000">// Check if the token expires in the next 5 minutes, if so, trigger a</span>
<span style="color: #000000">    </span><span style="color: #008000">// silent refresh of the Access Token in the OIDC Service</span>
<span style="color: #000000">    </span><span style="color: #001080">token</span><span style="color: #000000">.</span><span style="color: #001080">expires</span><span style="color: #000000"> - </span><span style="color: #267F99">Date</span><span style="color: #000000">.</span><span style="color: #795E26">now</span><span style="color: #000000">() / </span><span style="color: #098658">1000</span><span style="color: #000000"> &lt; </span><span style="color: #098658">300</span>
<span style="color: #000000">  ) {</span>
<span style="color: #000000">    </span><span style="color: #001080">SessionUtil</span><span style="color: #000000">.</span><span style="color: #795E26">silentRefreshAccessToken</span><span style="color: #000000">();</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">};</span>

<span style="color: #008000">// ==================================================</span>
<span style="color: #008000">// == SOMEWHERE IN THE ROUTER AUTHENTICATION CHECK ==</span>
<span style="color: #008000">// ==================================================</span>
<span style="color: #001080">SessionService</span><span style="color: #000000">.</span><span style="color: #795E26">checkSession</span><span style="color: #000000">().</span><span style="color: #795E26">then</span><span style="color: #000000">((</span><span style="color: #001080">isAuthenticated</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">isAuthenticated</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">storedToken</span><span style="color: #000000"> = </span><span style="color: #795E26">getStoredToken</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #008000">// If the authentication was successful, we request</span>
<span style="color: #000000">    </span><span style="color: #008000">// a new token (if it is about to expire).</span>
<span style="color: #000000">    </span><span style="color: #795E26">refreshTokenAboutToExpire</span><span style="color: #000000">(</span><span style="color: #001080">storedToken</span><span style="color: #000000">);</span>

<span style="color: #000000">    </span><span style="color: #008000">// Returning the auth check result here...</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">});</span>

<span style="color: #008000">// =================================</span>
<span style="color: #008000">// == SOMEWHERE IN AN API REQUEST ==</span>
<span style="color: #008000">// =================================</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">storedToken</span><span style="color: #000000"> = </span><span style="color: #795E26">getStoredToken</span><span style="color: #000000">();</span>
<span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">storedToken</span><span style="color: #000000">) {</span>
<span style="color: #000000">  </span><span style="color: #001080">config</span><span style="color: #000000">.</span><span style="color: #001080">headers</span><span style="color: #000000">[</span><span style="color: #A31515">&quot;Authorization&quot;</span><span style="color: #000000">] = </span><span style="color: #001080">SessionUtil</span><span style="color: #000000">.</span><span style="color: #795E26">getAuthHeader</span><span style="color: #000000">(</span><span style="color: #001080">storedToken</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span><span style="color: #008000">// After adding the headers, we request</span>
<span style="color: #000000">  </span><span style="color: #008000">// a new token (if it is about to expire).</span>
<span style="color: #000000">  </span><span style="color: #795E26">refreshTokenAboutToExpire</span><span style="color: #000000">(</span><span style="color: #001080">storedToken</span><span style="color: #000000">);</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#login" id="login" style="color: inherit; text-decoration: none;">
					<h2>Login</h2>
				</a>
				<p>The login consists of two steps. Step 1 is to send authentication data to the server (<em>username</em> and <em>password</em> and <em>csrf token</em>). Step 2 is processing the response from the server.</p>
				<a href="#sending-authentication-data-to-the-server" id="sending-authentication-data-to-the-server" style="color: inherit; text-decoration: none;">
					<h1>Sending authentication data to the server</h1>
				</a>
				<p>Most of the time, it is not needed to create a custom login page. The default page of the CIAM server can be used. The client id can be used by CIAM to determine which login page should be served.</p>
				<p>If you are going to create a custom CIAM login page, you need to make sure that besides the username and password, you also send a Cross Site Request Forgery token (csrf) to the SSO server. This can be obtained with the <code>getCsrfToken()</code> method.</p>
				<a href="#processing-the-response-from-the-server" id="processing-the-response-from-the-server" style="color: inherit; text-decoration: none;">
					<h3>Processing the response from the server</h3>
				</a>
				<p>An auth token will be present in a response from the server after a successful login. This token must be stored on the user&#39;s local computer. The auth token is present in the hash fragment of the redirect url from the server to the client. So, you need to make sure you will not clear the URL before saving it locally.</p>
				<pre><code class="language-ts"><span style="color: #008000">// The check session method is used for both checking if the user is logged in</span>
<span style="color: #008000">// as well as saving the access token present in the URL hash.</span>
<span style="color: #008000">// After the URL has been saved, it will be cleared.</span>
<span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">SessionService</span><span style="color: #000000">.</span><span style="color: #795E26">checkSession</span><span style="color: #000000">();</span>
</code></pre>
				<p>The current implementation of the redirect from the server only goes to a single URL. This means that restoring the user session (the url where the user was before logging in) is a responsibility of the front-end. Take into account that routes which do not require authentication should not call the check session function (as it will trigger a login).</p>
				<p>Because the check session function is used both for the login check and to store the token, it is recommended to do a front-end redirect where the URL hash is kept intact before the check session is used to store the token. This way the user is sent to the correct route after login, which calls the check session anyway (to check if the user is logged in) and consequently also stores the token.</p>
				<p><img src="images/login-flow.png" alt="Login flow"></p>
				<a href="#logout" id="logout" style="color: inherit; text-decoration: none;">
					<h2>Logout</h2>
				</a>
				<p>The logout form needs a <strong>logout endpoint</strong>, a Cross Site Request Forgery Token (<strong>_csrf</strong>), a URL to redirect to after the logout has succeeded (<strong>post_logout_redirect_uri</strong>) and an ID Token (<strong>id_token_hint</strong>). The form can be submitted in an automated fashion after all inputs have been set. If the <em>_csrf</em> or <em>id_token_hint</em> cannot be resolved, an error page should be shown.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">configService</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #008000">// The LOGOUT_ENDPOINT can be requested from</span>
<span style="color: #795E26">getOidcConfig</span><span style="color: #000000">().</span><span style="color: #001080">logout_endpoint</span><span style="color: #000000">;</span>

<span style="color: #008000">// The POST_LOGOUT_REDIRECT_URI can be requested from</span>
<span style="color: #795E26">getOidcConfig</span><span style="color: #000000">().</span><span style="color: #001080">post_logout_redirect_uri</span><span style="color: #000000">;</span>

<span style="color: #008000">// The CSRF_TOKEN can be requested from</span>
<span style="color: #008000">//  Synchronously (try this first)</span>
<span style="color: #001080">StorageUtil</span><span style="color: #000000">.</span><span style="color: #795E26">read</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;_csrf&quot;</span><span style="color: #000000">);</span>
<span style="color: #008000">//  Asynchronously</span>
<span style="color: #795E26">getCsrfToken</span><span style="color: #000000">();</span>

<span style="color: #008000">// The ID_TOKEN_HINT can be requested from</span>
<span style="color: #795E26">getIdTokenHint</span><span style="color: #000000">({ </span><span style="color: #001080">regex:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000"> });</span>
</code></pre>
				<pre><code class="language-html"><span style="color: #800000">&lt;form</span><span style="color: #000000"> </span><span style="color: #FF0000">method</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;POST&quot;</span><span style="color: #000000"> </span><span style="color: #FF0000">action</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;LOGOUT_ENDPOINT&quot;</span><span style="color: #800000">&gt;</span>
<span style="color: #000000">  </span><span style="color: #800000">&lt;input</span><span style="color: #000000"> </span><span style="color: #FF0000">type</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;hidden&quot;</span><span style="color: #000000"> </span><span style="color: #FF0000">name</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;_csrf&quot;</span><span style="color: #000000"> </span><span style="color: #FF0000">value</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;CSRF_TOKEN&quot;</span><span style="color: #000000"> </span><span style="color: #800000">/&gt;</span>

<span style="color: #000000">  </span><span style="color: #800000">&lt;input</span>
<span style="color: #000000">    </span><span style="color: #FF0000">type</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;hidden&quot;</span>
<span style="color: #000000">    </span><span style="color: #FF0000">name</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;post_logout_redirect_uri&quot;</span>
<span style="color: #000000">    </span><span style="color: #FF0000">value</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;POST_LOGOUT_REDIRECT_URI&quot;</span>
<span style="color: #000000">  </span><span style="color: #800000">/&gt;</span>

<span style="color: #000000">  </span><span style="color: #800000">&lt;input</span><span style="color: #000000"> </span><span style="color: #FF0000">type</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;hidden&quot;</span><span style="color: #000000"> </span><span style="color: #FF0000">name</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;id_token_hint&quot;</span><span style="color: #000000"> </span><span style="color: #FF0000">value</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;ID_TOKEN_HINT&quot;</span><span style="color: #000000"> </span><span style="color: #800000">/&gt;</span>
<span style="color: #800000">&lt;/form&gt;</span>
</code></pre>
				<a href="#automatic-logout" id="automatic-logout" style="color: inherit; text-decoration: none;">
					<h2>Automatic logout</h2>
				</a>
				<p>If the session is closed due to inactivity, the user must be logged out to protect the data still on the local computer from access by unauthorised parties. After redirecting to the logged out page, the authentication information will be removed.</p>
				<p>In the case a user may still be logged in on another client, they should not be logged out. This is what the isSessionAlive call is for. It checks the server to see if the user is still logged in somewhere. Logging out would also destroy the session for other clients. This would cause these users to eventually be rejected when requesting a renewal of the session, even though they might still be actively using the session.</p>
				<p>The <code>isSessionAlive</code> call does not count as user activity, and will as such not lengthen the session.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #001080">TokenService</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">SessionService</span><span style="color: #000000">,</span>
<span style="color: #000000">} </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">autoLogoutInterval</span><span style="color: #000000"> = </span><span style="color: #795E26">setInterval</span><span style="color: #000000">(() </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #008000">// Get stored token either returns a non-expired token or null</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">storedToken</span><span style="color: #000000"> = </span><span style="color: #795E26">getStoredToken</span><span style="color: #000000">();</span>

<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #001080">storedToken</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">SessionService</span><span style="color: #000000">.</span><span style="color: #795E26">isSessionAlive</span><span style="color: #000000">().</span><span style="color: #795E26">catch</span><span style="color: #000000">(() </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #008000">// If we are not logged in, no expired check is needed.</span>
<span style="color: #000000">      </span><span style="color: #795E26">clearInterval</span><span style="color: #000000">(</span><span style="color: #001080">autoLogoutInterval</span><span style="color: #000000">);</span>

<span style="color: #000000">      </span><span style="color: #008000">// Remove user information that may exist next to the auth information</span>
<span style="color: #000000">      </span><span style="color: #795E26">clearUserInformation</span><span style="color: #000000">();</span>

<span style="color: #000000">      </span><span style="color: #008000">// You may set a session restore URL here to be used on the</span>
<span style="color: #000000">      </span><span style="color: #008000">// login page.</span>
<span style="color: #000000">      </span><span style="color: #795E26">setSessionRestoreUrl</span><span style="color: #000000">();</span>

<span style="color: #000000">      </span><span style="color: #008000">// Navigate to the logged out page via the router.</span>
<span style="color: #000000">      </span><span style="color: #795E26">navigateToLoggedOutPage</span><span style="color: #000000">();</span>
<span style="color: #000000">    });</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">}, </span><span style="color: #098658">15000</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#logged-out-page" id="logged-out-page" style="color: inherit; text-decoration: none;">
					<h2>Logged out page</h2>
				</a>
				<p>See the FAQ for the difference between a logout page and a logged out page.</p>
				<p>The logged out page is used to show the user that he has been logged out. Next to this, it should remove local authentication information. This includes local storage on the current domain as well as cookies on other domains via a logout pixel.</p>
				<a href="#clean-up" id="clean-up" style="color: inherit; text-decoration: none;">
					<h3>Clean up</h3>
				</a>
				<p>Remove possible left-overs of the previous session.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">SessionService</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #008000">// Upon opening the logged out page</span>
<span style="color: #001080">SessionService</span><span style="color: #000000">.</span><span style="color: #795E26">cleanSessionStorage</span><span style="color: #000000">();</span>
</code></pre>
				<a href="#logout-pixel" id="logout-pixel" style="color: inherit; text-decoration: none;">
					<h3>Logout pixel</h3>
				</a>
				<blockquote>
					<p>! This is an opinionated way of handling logout.</p>
				</blockquote>
				<p>In case there multiple domains that need to be logged out at once, you may choose to include logout pixels. With a logout pixel, you include an invisible iframe or image on the site which is hosted on another domain. The embedded element contains some logic to logout on the hosting domain. In this way the same domain policy for cookies and other local ways authentication data storage can be circumvented.
				<img src="images/logout-pixel.png" alt="Logout pixel flow"></p>
				<pre><code class="language-html"><span style="color: #008000">&lt;!-- As iframe --&gt;</span>
<span style="color: #800000">&lt;iframe</span>
<span style="color: #000000">  </span><span style="color: #FF0000">src</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;https://example.com/logoutpixel&quot;</span>
<span style="color: #000000">  </span><span style="color: #FF0000">width</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;0&quot;</span>
<span style="color: #000000">  </span><span style="color: #FF0000">height</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;0&quot;</span>
<span style="color: #000000">  </span><span style="color: #FF0000">class</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;hidden&quot;</span>
<span style="color: #800000">&gt;&lt;/iframe&gt;</span>

<span style="color: #008000">&lt;!-- As img --&gt;</span>
<span style="color: #800000">&lt;img</span>
<span style="color: #000000">  </span><span style="color: #FF0000">src</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;https://example.com/logoutpixel&quot;</span>
<span style="color: #000000">  </span><span style="color: #FF0000">width</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;0&quot;</span>
<span style="color: #000000">  </span><span style="color: #FF0000">height</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;0&quot;</span>
<span style="color: #000000">  </span><span style="color: #FF0000">class</span><span style="color: #000000">=</span><span style="color: #0000FF">&quot;hidden&quot;</span>
<span style="color: #800000">/&gt;</span>
</code></pre>
				<p>If you are creating a logout pixel, you need to:</p>
				<ol>
					<li>Make an array of all access tokens in the session storage<ol>
							<li> Call the logout endpoint with each token</li>
							<li> Remove the token from session storage</li>
						</ol>
					</li>
					<li> Remove the _csrf token from session storage</li>
				</ol>
				<a href="#faq" id="faq" style="color: inherit; text-decoration: none;">
					<h2>FAQ</h2>
				</a>
				<a href="#what-is-a-silent-logout" id="what-is-a-silent-logout" style="color: inherit; text-decoration: none;">
					<h3>What is a silent logout?</h3>
				</a>
				<p>With a silent logout, you are logged out in the background. This means that you are not redirected to a logged-out page. However, the access token will be invalidated. You would use this when you need the user to be logged out in order to perform a certain action. If you are going to use this method, be sure to clean the session storage afterwards.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #001080">SessionService</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">SessionUtil</span><span style="color: #000000">,</span>
<span style="color: #000000">} </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@hawaii-framework/oidc-implicit-core/dist&quot;</span><span style="color: #000000">;</span>

<span style="color: #001080">SessionUtil</span><span style="color: #000000">.</span><span style="color: #795E26">silentLogoutByUrl</span><span style="color: #000000">().</span><span style="color: #795E26">then</span><span style="color: #000000">((</span><span style="color: #001080">loggedOut</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">loggedOut</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">SessionService</span><span style="color: #000000">.</span><span style="color: #795E26">cleanSessionStorage</span><span style="color: #000000">();</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">});</span>
</code></pre>
				<a href="#what-is-a-silent-refresh" id="what-is-a-silent-refresh" style="color: inherit; text-decoration: none;">
					<h3>What is a silent refresh?</h3>
				</a>
				<p>With a silent refresh, the lifetime of a token is renewed in the background, without user interaction. The Authorization Server will not display any authentication or consent user interface pages. An error is returned if an End-User is not already authenticated. For more info, see the <a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest">OpenID Connect Core spec</a>.</p>
				<a href="#what-is-the-difference-between-a-logout-page-and-a-logged-out-page" id="what-is-the-difference-between-a-logout-page-and-a-logged-out-page" style="color: inherit; text-decoration: none;">
					<h3>What is the difference between a logout page and a logged out page?</h3>
				</a>
				<ul>
					<li>The purpose of a <strong>logout page</strong> is to initiate and authorise the termination of a session.</li>
					<li>The purpose of a <strong>logged out page</strong> is to show the user that he has been logged out. In addition, the <strong>logged out page</strong> is used to remove authentication information.</li>
				</ul>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/oidcservice.html">Oidc<wbr>Service</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-interface">
						<a href="interfaces/csrftoken.html" class="tsd-kind-icon">Csrf<wbr>Token</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/oidcconfig.html" class="tsd-kind-icon">Oidc<wbr>Config</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/token.html" class="tsd-kind-icon">Token</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#authorizeerrors" class="tsd-kind-icon">Authorize<wbr>Errors</a>
					</li>
					<li class=" tsd-kind-variable">
						<a href="modules.html#authorize_errors" class="tsd-kind-icon">AUTHORIZE_<wbr>ERRORS</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>